<!doctype html>
<html lang="ja">
  <head>
	  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	  <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/choir.css">
		<script src="/js/get_mp3.js"></script>
    <script src="/js/get_information.js"></script>
    <script src="/js/svgPiano.js"></script>
    <script src="/js/howler.core.js"></script>
    <script src="https://unpkg.com/@tonejs/midi"></script>
    <script type="text/javascript">
      const mp3Files = {
        soprano : '/easter/ShizukaniMate/ShizukaniMate(soprano).mp3',
        soprano_amen : '/easter/ShizukaniMate/ShizukaniMate(soprano_amen).mp3',
        alto    : '/easter/ShizukaniMate/ShizukaniMate(alto).mp3',
        tenor   : '/easter/ShizukaniMate/ShizukaniMate(tenor).mp3',
        bass    : '/easter/ShizukaniMate/ShizukaniMate(bass).mp3',
        full    : '/easter/ShizukaniMate.mp3',
      };
      const midiFiles = {
        soprano : ['/easter/ShizukaniMate/ShizukaniMate.mid',0],
        soprano_amen : ['/easter/ShizukaniMate/ShizukaniMate(soprano_amen).mid',0],
        alto    : ['/easter/ShizukaniMate/ShizukaniMate.mid',1],
        tenor   : ['/easter/ShizukaniMate/ShizukaniMate.mid',2],
        bass    : ['/easter/ShizukaniMate/ShizukaniMate.mid',3],
        full    : ['/easter/ShizukaniMate/ShizukaniMate.mid',[0,1,2,3]]
      };
      const ranges = {
            'A':'0,11.2',
            'B':'11.5,22.7',
            'C':'22.9,34.4',
            'D':'34.4,45.5',
            'E':'46.6,56.9',
            'F':'57.2,68',
            'G':'137,147',
            'G2':'0,8'
        };
    </script>
    <style type="text/css">
      div.audio-container {
        height: 30px;
        width: 400px;
        display: flex;
        flex-direction: row;
        align-items: center;
        margin-bottom: 10px;
        gap: 5px
      }
      span.timeDisplay {
        width: auto;
        font-size: 12px;
        text-wrap: nowrap;
      }
      div.segment-btn-container {
        width: auto;
        display: block;
        margin-bottom: 10px;
      }
      div.segment-btn-container button {
        width: auto;
        height: 1.6em;
        margin-right: 5px;
      }
      li {height: auto;}
      li div {
        width: "";
        display: block;
      }
      span.part {
        vertical-align: super;
        font-size:0.6em;
        color : blue;
        border: solid 1px #454545;
      }
    </style>
    <title>'しずかに待てわがたまよ（聖歌294）'パート別練習用音源</title>
  </head>
  <body>
    <div class="body">
    <div style="display:block;font-size:60%;line-height:120%;text-indent:-1.5em;width:300px;color:#000080;">※ 午後10時から午前8時までの間は、動き出すまで少々時間がかかります。10数秒で動き出すのでお待ちください。</div>
    <h1>パート別練習用音源</h1>
    <div>
     <h4>しずかに待てわがたまよ（聖歌294）</h4>
      <ul style="list-style: none;">
        <li>
          <div class="part">ソプラノ</div>
          <div class="audio-container" name="soprano"></div>
          <div class="segment-btn-container" name="soprano">
            <button class="playBtn" name='A'>A</button>
            <button class="playBtn" name='B'>B</button>
            <button class="playBtn" name='C'>C</button>
            <button class="playBtn" name='D'>D</button>
            <button class="playBtn" name='E'>E</button>
            <button class="playBtn" name='F'>F</button>
            <button class="playBtn" name='G'>G</button>
            <button class="playBtn" name='G2'>G2</button>
          </div>
        </li>
        <li>
          <div class="part">アルト</div>
          <div class="audio-container" name="alto"></div>
          <div class="segment-btn-container" name="alto">
            <button class="playBtn" name='A'>A</button>
            <button class="playBtn" name='B'>B</button>
            <button class="playBtn" name='C'>C</button>
            <button class="playBtn" name='D'>D</button>
            <button class="playBtn" name='E'>E</button>
            <button class="playBtn" name='F'>F</button>
            <button class="playBtn" name='G'>G</button>
          </div>
        </li>
        <li>
          <div class="part">テノール</div>
          <div class="audio-container" name="tenor"></div>
          <div class="segment-btn-container" name="tenor">
            <button class="playBtn" name='A'>A</button>
            <button class="playBtn" name='B'>B</button>
            <button class="playBtn" name='C'>C</button>
            <button class="playBtn" name='D'>D</button>
            <button class="playBtn" name='E'>E</button>
            <button class="playBtn" name='F'>F</button>
            <button class="playBtn" name='G'>G</button>
          </div>
        </li>
        <li>
          <div class="part">バス</div>
          <div class="audio-container" name="bass"></div>
          <div class="segment-btn-container" name="bass">
            <button class="playBtn" name='A'>A</button>
            <button class="playBtn" name='B'>B</button>
            <button class="playBtn" name='C'>C</button>
            <button class="playBtn" name='D'>D</button>
            <button class="playBtn" name='E'>E</button>
            <button class="playBtn" name='F'>F</button>
            <button class="playBtn" name='G'>G</button>
          </div>
        </li>
        <li>
          <div class="part">コーラス</div>
          <div class="audio-container" name="full"></div>
          <div class="segment-btn-container" name="full">
            <button class="playBtn" name='A'>A</button>
            <button class="playBtn" name='B'>B</button>
            <button class="playBtn" name='C'>C</button>
            <button class="playBtn" name='D'>D</button>
            <button class="playBtn" name='E'>E</button>
            <button class="playBtn" name='F'>F</button>
            <button class="playBtn" name='G'>G</button>
          </div>
        </li>
        <li>
          <div class="part">Be Still My Soul (Exultate Singers)</div>
          <audio src='/easter/ShizukaniMate/Be Still My Soul(Exultate Singers).mp3' controls preload="none"></audio>
          &nbsp;&nbsp;<a href='/easter/ShizukaniMate/Be Still My Soul(Exultate Singers).mp3' download><img src='/img/download-m.png'></a>
        </li>
        <li>
          <div class="part">Sibelius Finlandia (BBC Prom)</div>
          <audio src='/easter/ShizukaniMate/Sibelius Finlandia (BBC Prom).mp3' controls preload="none"></audio>
          &nbsp;&nbsp;<a href='/easter/ShizukaniMate/Sibelius Finlandia (BBC Prom).mp3' download><img src='/img/download-m.png'></a>
        </li>
      </ul>
    <div>
      <br>
      <div class="lyrics">
        1 <span class="part">A</span> 　しずかに<span>3</span>　まてわがたまよ<span>4</span><br>
        　<span class="part">B</span> 　肩もつ<span>3</span>　　神はませり<span>5</span><br>
        　<span class="part">C</span>  <span>mf</span>しのびて<span>3</span>　十字架をになえ<span>4</span><br>
        　<span class="part">D</span>　なが神<span>3</span>　　<span>f </span>たすけたま<span>p</span>わ<span>f</span>ん<span>5</span><br>
        　<span class="part">E</span>  <span>　f </span>いばらの<span>3</span>　道の彼方に<span>4</span><br>
        　<span class="part">F</span> 　たえなる<span>3</span>　よろこびあり<span>5</span><br>
    
        2 <span class="part">A</span> 　しずかに<span>3</span>　まてわがたまよ<span>4</span><br>
        　<span class="part">B</span> 　なが道<span>3</span>　　神は知らす<span>5</span><br>
        　<span class="part">C</span>  <span>mf</span>くらやみ<span>3</span>　空をおおえど<span>4</span><br>
        　<span class="part">D</span>　かなたに<span>3</span>　<span>f </span>かがやきあ<span>p</span>り<span>f　5</span><br>
        　<span class="part">E</span>  <span>　f </span>なみかぜ<span>3</span>　荒れくるうとも<span>4</span><br>
        　<span class="part">F</span> 　ただちに<span>3</span>　神はしずめん<span>5</span><br>
        
        3 <span class="part">A</span> 　しずかに<span>3</span>　まてわがたまよ<span>4</span><br>
        　<span class="part">B</span> 　神におう<span>3</span>　朝は近し<span>5</span><br>
        　<span class="part">C</span>  <span>mf</span>そのとき<span>3</span>　空に雲なく<span>4</span><br>
        　<span class="part">D</span>　なみだの<span>3</span>　<span>f </span>霧もはれ<span>p</span>て<span>f　5</span><br>
        　<span class="part">E</span>  <span>　f </span>かがやく<span>3</span>　み顔をあおぎ<span>4</span><br>
        　<span class="part">F</span> 　わがたま<span>3</span>　みちたるをえん<span>5</span><br>
        　<span class="part">G</span> 　アーメン<br>
    
        <span style="font-size:50%">※ 上付きの数字は何拍伸ばすかを示す.</span>
      </div>
      <br>
      <div id="piano-container"></div>

      <div class='link'>
        <a href='/mcc/index.html'>⇒ MCCワーシップクワイアーの持ち歌のページに戻る.</a>
      </div>
    </div>
    </div>
    <script>
      // ピアノ鍵盤のSVGを作成
      const svgPiano = new SvgPiano(
        'piano-container',
        {
            min_key_number: 39,
            number_of_white_keys: 23,
            white_key_width: 30,
            white_key_height: 120,
            black_key_width: 24,
            black_key_height: 70,
            volume: 0.5,
            key: '♭1',
            justIntnation: true
        }
      );
      // パート別に play,pause,stopの各ボタン、seekBar,timeDisplay を作成
      const audioControls = setAudioControls(".audio-container");
    
      // audioControlインスタンスに、svgPiano,midiファイル,mp3ファイル等を設定
      audioControls.forEach(audioControl => {
        const name = audioControl.options.name;
        audioControl.update({
          svgPiano: svgPiano,
          mp3File: mp3Files[name],
          midiFile: midiFiles[name][0],
          trackIndex: midiFiles[name][1],
        });
      });
    
      document.querySelectorAll(".playBtn").forEach(btn => {
        btn.addEventListener("click", function() {
          const parentName = btn.parentNode.getAttribute("name");
          const segment = btn.getAttribute("name");
          const audioControl = audioControls.find(control => control.options.name === parentName );
          
          if (segment !== 'G2') {
            if (audioControl.options.currentFileSetIndex != 0) {
              audioControl.switchFileSet('Original');
            }
            const range = ranges[segment];
            const [start,end] = range.split(",");      
            console.log(`start,end => ${start},${end}`);
            
            audioControl.update({ segment: range })
            
            if (Number(start) < audioControl.seekBar.value) {
              console.log(`audioControl.seekBar.value => ${audioControl.seekBar.value}`);
              audioControl.playSegment(audioControl.seekBar.value,Number(end));
            } else {
              console.log("audioControl.playSegment()")
              audioControl.playSegment();
            }
          } else {
            if (audioControl.options.currentFileSetIndex == 0) {
              audioControl.switchFileSet('soprano_amen');
              setTimeout(() => {
                audioControl.play();
              }, 500);
            } else {
              audioControl.play();
            }
          }
        });
      });
      // ソプラノのG2の音源等ファイルセットを追加
      const sopranoAudioControl = audioControls.find(control => control.options.name === 'soprano');
      sopranoAudioControl.addFileSet({
        mp3File: mp3Files['soprano_amen'],
        midiFile: midiFiles['soprano_amen'][0],
        trackIndex: midiFiles['soprano_amen'][1],
        name: 'soprano_amen'
      });
    </script>
  </body>
</html>